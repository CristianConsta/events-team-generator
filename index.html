<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' https://apis.google.com https://www.gstatic.com https://accounts.google.com; style-src 'self' 'unsafe-inline'; img-src 'self' data: https://lh3.googleusercontent.com; connect-src 'self' https://firestore.googleapis.com https://identitytoolkit.googleapis.com https://securetoken.googleapis.com https://www.googleapis.com https://*.googleapis.com; font-src 'self' data:; base-uri 'none'; frame-src https://accounts.google.com https://*.google.com https://*.firebaseapp.com https://last-war-game-desert-storm.firebaseapp.com; form-action 'self';">
    <link rel="icon" href="data:,">
    <title>Video Games Events Players Selection</title>
    <!-- Firebase SDKs -->
    <script defer src="vendor/firebase-app-compat.js"></script>
    <script defer src="vendor/firebase-auth-compat.js"></script>
    <script defer src="vendor/firebase-firestore-compat.js"></script>
    <script defer src="firebase-config.js"></script>
    <script defer src="firebase-module.js"></script>

    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Login Screen -->
    <section id="loginScreen" aria-labelledby="loginTitle">
        <div class="login-card">
            <h1 id="loginTitle" class="login-title" data-i18n="login_title">Video Games Events Players Selection</h1>
            <h3 class="login-subtitle" data-i18n="login_subtitle">Sign in to continue</h3>
            
            <button id="googleSignInBtn" class="login-btn login-btn-provider">
                ðŸ”µ <span data-i18n="login_google">Sign in with Google</span>
            </button>
            
            <div class="login-divider" data-i18n="login_or">or</div>
            
            <form id="loginForm" class="login-form">
                <label for="emailInput" class="login-label" data-i18n="login_email_placeholder">Email</label>
                <input type="email" id="emailInput" class="login-input" placeholder="Email" data-i18n-placeholder="login_email_placeholder" autocomplete="username">
                <label for="passwordInput" class="login-label" data-i18n="login_password_placeholder">Password</label>
                <input type="password" id="passwordInput" class="login-input" placeholder="Password" data-i18n-placeholder="login_password_placeholder" autocomplete="current-password">
                
                <button type="submit" class="login-btn login-btn-primary">
                    <span data-i18n="login_sign_in">Sign In</span>
                </button>
            </form>
            
            <button id="showSignUpBtn" type="button" class="login-btn login-btn-secondary">
                <span data-i18n="login_create_account">Create New Account</span>
            </button>
            
            <button id="passwordResetBtn" type="button" class="login-btn login-btn-link">
                <span data-i18n="login_forgot_password">Forgot Password?</span>
            </button>
            
            <select id="loginLanguageSelect" class="login-language-select">
                <option value="en">EN</option>
                <option value="fr">FR</option>
                <option value="de">DE</option>
                <option value="it">IT</option>
                <option value="ko">KO</option>
                <option value="ro">RO</option>
            </select>

            <div id="statusMessage" class="login-status"></div>
        </div>
    </section>

    <!-- Main App -->
    <main id="mainApp">
        <!-- User Header -->
        <header id="userHeader">
            <div id="userHeaderTop">
                <div id="headerLeft">
                    <nav id="navMenu" class="header-menu" aria-label="Primary">
                        <button id="navMenuBtn" class="secondary header-icon-btn" title="Menu" aria-label="Menu" aria-haspopup="menu" aria-expanded="false" aria-controls="navMenuPanel">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"><line x1="4" y1="6" x2="20" y2="6"/><line x1="4" y1="12" x2="20" y2="12"/><line x1="4" y1="18" x2="20" y2="18"/></svg>
                            <span class="btn-label" data-i18n="navigation_menu">Menu</span>
                        </button>
                        <div id="navMenuPanel" class="header-menu-panel hidden" role="menu" aria-label="Menu">
                            <button id="navGeneratorBtn" class="header-menu-item" role="menuitem">
                                <span class="header-menu-item-icon" aria-hidden="true">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.1" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2"/><path d="M3 9h18"/><path d="M9 21V9"/></svg>
                                </span>
                                <span data-i18n="generator_button">Generator</span>
                            </button>
                            <button id="navPlayersBtn" class="header-menu-item" role="menuitem">
                                <span class="header-menu-item-icon" aria-hidden="true">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.1" stroke-linecap="round" stroke-linejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="8.5" cy="7" r="4"/><path d="M20 8v6"/><path d="M17 11h6"/></svg>
                                </span>
                                <span data-i18n="players_management_button">Players Management</span>
                            </button>
                            <button id="navConfigBtn" class="header-menu-item" role="menuitem">
                                <span class="header-menu-item-icon" aria-hidden="true">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.1" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2v4"/><path d="m16.2 7.8 2.9-2.9"/><path d="M18 12h4"/><path d="m16.2 16.2 2.9 2.9"/><path d="M12 18v4"/><path d="m4.9 19.1 2.9-2.9"/><path d="M2 12h4"/><path d="m4.9 4.9 2.9 2.9"/><circle cx="12" cy="12" r="4"/></svg>
                                </span>
                                <span data-i18n="events_manager_title">Events Manager</span>
                            </button>
                            <button id="navAllianceBtn" class="header-menu-item" role="menuitem">
                                <span class="header-menu-item-icon" aria-hidden="true">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.1" stroke-linecap="round" stroke-linejoin="round"><circle cx="6" cy="7" r="3"/><circle cx="18" cy="7" r="3"/><path d="M2 20a4 4 0 0 1 8 0"/><path d="M14 20a4 4 0 0 1 8 0"/><path d="M8 14a4 4 0 0 1 8 0"/></svg>
                                </span>
                                <span data-i18n="alliance_button">Alliance</span>
                            </button>
                            <button id="navSettingsBtn" class="header-menu-item" role="menuitem">
                                <span class="header-menu-item-icon" aria-hidden="true">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.1" stroke-linecap="round" stroke-linejoin="round"><path d="M12 15.5A3.5 3.5 0 1 0 12 8.5a3.5 3.5 0 0 0 0 7Z"/><path d="M19.4 15a1 1 0 0 0 .2 1.1l.1.1a2 2 0 1 1-2.8 2.8l-.1-.1a1 1 0 0 0-1.1-.2 1 1 0 0 0-.6.9V20a2 2 0 1 1-4 0v-.1a1 1 0 0 0-.6-.9 1 1 0 0 0-1.1.2l-.1.1a2 2 0 1 1-2.8-2.8l.1-.1a1 1 0 0 0 .2-1.1 1 1 0 0 0-.9-.6H4a2 2 0 1 1 0-4h.1a1 1 0 0 0 .9-.6 1 1 0 0 0-.2-1.1l-.1-.1a2 2 0 1 1 2.8-2.8l.1.1a1 1 0 0 0 1.1.2h.1a1 1 0 0 0 .5-.9V4a2 2 0 1 1 4 0v.1a1 1 0 0 0 .6.9h.1a1 1 0 0 0 1.1-.2l.1-.1a2 2 0 1 1 2.8 2.8l-.1.1a1 1 0 0 0-.2 1.1v.1a1 1 0 0 0 .9.5H20a2 2 0 1 1 0 4h-.1a1 1 0 0 0-.9.6Z"/></svg>
                                </span>
                                <span data-i18n="settings_button">Settings</span>
                            </button>
                            <div class="header-menu-divider"></div>
                            <button id="navSupportBtn" class="header-menu-item" role="menuitem">
                                <span class="header-menu-item-icon" aria-hidden="true">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.1" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M12 16v.01"/><path d="M12 8a2.5 2.5 0 0 1 2.1 3.9c-.8 1.1-2.1 1.5-2.1 2.6"/></svg>
                                </span>
                                <span data-i18n="support_button">Support</span>
                            </button>
                            <button id="navSignOutBtn" class="header-menu-item danger" role="menuitem">
                                <span class="header-menu-item-icon" aria-hidden="true">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.1" stroke-linecap="round" stroke-linejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
                                </span>
                                <span data-i18n="sign_out_button">Sign Out</span>
                            </button>
                        </div>
                    </nav>
                </div>

                <div id="headerActions">
                    <div id="headerProfileCluster">
                        <button id="headerProfileBtn" title="Settings">
                            <span id="headerAvatar" class="header-avatar" aria-hidden="true">
                                <img id="headerAvatarImage" class="hidden" alt="User avatar">
                                <span id="headerAvatarInitials">U</span>
                            </span>
                            <span id="headerUserText">
                                <span id="userIdentityLabel"></span>
                            </span>
                        </button>
                        <span id="allianceDisplay"></span>
                        <button id="allianceCreateBtn" title="Create/Join Alliance">
                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><line x1="21" y1="10" x2="21" y2="16"/><line x1="18" y1="13" x2="24" y2="13"/></svg>
                        </button>
                    </div>
                    <button id="notificationBtn" title="Notifications" aria-expanded="false">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/></svg>
                        <span id="notificationBadge">0</span>
                    </button>
                </div>
            </div>
        </header>

        <div class="container">

            <div id="alliancePage" class="app-view screen-shell hidden">
                <div class="card screen-panel">
                    <div class="page-header">
                        <h2 class="config-title" data-i18n="alliance_panel_title">Alliance</h2>
                    </div>
                    <div id="alliancePanelContent"></div>
                </div>
            </div>

            <div id="supportPage" class="app-view hidden">
                <div class="card support-hero">
                    <div class="page-header">
                        <h2 class="config-title">Support Center</h2>
                    </div>
                    <p>Welcome. This page is your complete guide for the platform, with quick ways to contact support and report improvements.</p>
                </div>

                <div class="card">
                    <h3 class="support-title">
                        <span class="support-section-icon" aria-hidden="true">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.1" stroke-linecap="round" stroke-linejoin="round"><path d="M12 20h9"/><path d="M16.5 3.5a2.1 2.1 0 0 1 3 3L7 19l-4 1 1-4Z"/></svg>
                        </span>
                        Platform Guide
                    </h3>
                    <div class="support-guide-grid">
                        <article class="support-guide-card">
                            <h4>Generator</h4>
                            <p>Choose the event first, then select players for Team A and Team B. Use filters to find players quickly and generate assignments for map and Excel export.</p>
                        </article>
                        <article class="support-guide-card">
                            <h4>Players Management</h4>
                            <p>Upload players from the template or add them manually. You can edit, filter, sort, and keep separate data sources for personal and alliance rosters.</p>
                        </article>
                        <article class="support-guide-card">
                            <h4>Events Manager</h4>
                            <p>Create and update events with name, avatar, uploaded map, buildings, priorities, and map visibility. Use Map Coordinates picker to place label anchors for each building.</p>
                        </article>
                        <article class="support-guide-card">
                            <h4>Alliance</h4>
                            <p>Create or join an alliance, invite teammates, accept invites, and switch player sources based on your workflow.</p>
                        </article>
                        <article class="support-guide-card">
                            <h4>Settings</h4>
                            <p>Update your profile (name, nickname, avatar), language, and theme. Theme changes apply across all pages including this Support view.</p>
                        </article>
                        <article class="support-guide-card">
                            <h4>Quick Success Path</h4>
                            <p>1) Upload players, 2) Verify event details and map, 3) Set map coordinates, 4) Select teams, 5) Generate assignments, 6) Download map and Excel.</p>
                        </article>
                    </div>
                </div>

                <div class="card support-grid">
                    <section class="support-box">
                        <h3 class="support-title">
                            <span class="support-section-icon" aria-hidden="true">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.1" stroke-linecap="round" stroke-linejoin="round"><path d="M20 13a6 6 0 0 0-12 0v4a2 2 0 0 0 2 2h1v-8H9a4 4 0 0 1 8 0h-2v8h1a2 2 0 0 0 2-2v-4"/><path d="M4 13a8 8 0 0 1 16 0"/></svg>
                            </span>
                            Contact Support
                        </h3>
                        <p>Discord profile: <strong>@flashguru2000</strong></p>
                        <div class="support-action-row">
                            <button id="supportCopyDiscordBtn" type="button" class="secondary">
                                <span class="support-btn-icon" aria-hidden="true">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.1" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
                                </span>
                                Copy Discord Handle
                            </button>
                            <button id="supportOpenDiscordBtn" type="button">
                                <span class="support-btn-icon" aria-hidden="true">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.1" stroke-linecap="round" stroke-linejoin="round"><path d="M14 3h7v7"/><path d="M10 14 21 3"/><path d="M21 14v7h-7"/><path d="M3 10V3h7"/><path d="m3 3 6 6"/></svg>
                                </span>
                                Open Discord
                            </button>
                        </div>
                    </section>

                    <section class="support-box">
                        <h3 class="support-title">
                            <span class="support-section-icon" aria-hidden="true">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.1" stroke-linecap="round" stroke-linejoin="round"><path d="M3 3h18v13H3z"/><path d="m8 21 4-4 4 4"/></svg>
                            </span>
                            Report Bug or Request Feature
                        </h3>
                        <p>Use this form to open a pre-filled GitHub issue for this repository.</p>
                        <div class="support-form-grid">
                            <label for="supportIssueTitle">Title</label>
                            <input id="supportIssueTitle" type="text" maxlength="120" placeholder="Short summary">
                            <label for="supportIssueDetails">Details</label>
                            <textarea id="supportIssueDetails" rows="6" maxlength="4000" placeholder="Describe what happened, what you expected, and any useful context."></textarea>
                        </div>
                        <div class="support-action-row">
                            <button id="supportReportBugBtn" type="button" class="danger-btn">
                                <span class="support-btn-icon" aria-hidden="true">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.1" stroke-linecap="round" stroke-linejoin="round"><path d="m8 2 1.8 1.8"/><path d="M14 2 12.2 3.8"/><path d="M9 7h6"/><rect x="4" y="7" width="16" height="13" rx="2"/><path d="M8 13h.01"/><path d="M16 13h.01"/></svg>
                                </span>
                                Report a Bug
                            </button>
                            <button id="supportRequestFeatureBtn" type="button" class="secondary">
                                <span class="support-btn-icon" aria-hidden="true">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.1" stroke-linecap="round" stroke-linejoin="round"><path d="M12 3v18"/><path d="M3 12h18"/></svg>
                                </span>
                                Ask for a Feature
                            </button>
                        </div>
                        <div id="supportStatus"></div>
                    </section>
                </div>
            </div>

            <template id="allianceJoinTemplate">
                <div class="alliance-panel-block">
                    <h3 class="alliance-panel-subtitle"></h3>
                    <div class="alliance-form-row">
                        <input type="text" id="newAllianceName" maxlength="40">
                        <button id="allianceCreateActionBtn" type="button"></button>
                    </div>
                    <div id="allianceCreateStatus"></div>
                </div>
                <div id="allianceInvitesSection"></div>
            </template>

            <template id="allianceMemberTemplate">
                <div class="alliance-panel-meta">
                    <div class="alliance-panel-meta-row">
                        <strong id="allianceMemberName" class="alliance-panel-gold-text"></strong>
                        <span id="allianceMemberCount" class="alliance-panel-muted"></span>
                    </div>
                </div>
                <div class="alliance-panel-block">
                    <h3 id="allianceMembersTitle" class="alliance-panel-subtitle"></h3>
                    <div id="allianceMembersList" class="alliance-members-list"></div>
                </div>
                <div class="alliance-panel-block">
                    <h3 id="allianceInviteTitle" class="alliance-panel-subtitle"></h3>
                    <div class="alliance-form-row">
                        <input type="email" id="inviteEmail">
                        <button id="allianceInviteActionBtn" type="button"></button>
                    </div>
                    <div id="allianceInviteHint" class="alliance-panel-hint"></div>
                    <div id="inviteStatus"></div>
                </div>
                <div id="allianceInvitesSection"></div>
                <button id="allianceLeaveBtn" class="clear-btn alliance-leave-btn" type="button"></button>
                <div id="allianceActionStatus"></div>
            </template>

            <template id="allianceInvitesEmptyTemplate">
                <div class="alliance-panel-block alliance-panel-block--invites">
                    <h3 class="alliance-panel-subtitle"></h3>
                    <p class="alliance-panel-muted"></p>
                </div>
            </template>

            <template id="allianceInvitesSectionTemplate">
                <div class="alliance-panel-block alliance-panel-block--invites">
                    <h3 class="alliance-panel-subtitle"></h3>
                    <p class="alliance-panel-help"></p>
                    <div id="allianceInvitesLockedHint" class="alliance-panel-lock-hint hidden"></div>
                    <div id="allianceInvitesCards" class="alliance-invite-cards"></div>
                    <div id="allianceInvitesStatus"></div>
                </div>
            </template>

            <template id="allianceInviteCardTemplate">
                <div class="alliance-invite-card">
                    <div class="alliance-invite-alliance"></div>
                    <div class="alliance-invite-sender"></div>
                    <div class="alliance-invite-created hidden"></div>
                    <div class="alliance-invite-actions">
                        <button type="button" data-invite-action="accept"></button>
                        <button type="button" class="clear-btn" data-invite-action="reject"></button>
                    </div>
                </div>
            </template>

            <div id="notificationsPanel" class="card hidden">
                <div class="notifications-panel-header">
                    <h3 class="notifications-panel-title" data-i18n="notifications_title">Notifications</h3>
                    <button id="notificationsPanelCloseBtn" class="clear-btn"><span data-i18n="close">Close</span></button>
                </div>
                <div id="notificationsList"></div>
            </div>

            <div id="settingsModal" class="coord-overlay hidden" role="dialog" aria-modal="true" aria-labelledby="settingsModalTitle" tabindex="-1">
                <div id="settingsModalCard" class="modal-shell modal-shell--settings">
                    <div class="settings-modal-header">
                        <h2 id="settingsModalTitle" class="modal-title" data-i18n="settings_title">Settings</h2>
                        <button id="settingsModalCloseBtn" class="clear-btn"><span data-i18n="close">Close</span></button>
                    </div>
                    <p class="modal-description" data-i18n="settings_description">Set how your profile appears in the header.</p>

                    <div class="settings-form-grid">
                        <label for="settingsDisplayNameInput" data-i18n="settings_display_name_label">Name</label>
                        <input id="settingsDisplayNameInput" type="text" maxlength="60" data-i18n-placeholder="settings_display_name_placeholder" placeholder="Name">
                        <label for="settingsNicknameInput" data-i18n="settings_nickname_label">Nickname</label>
                        <input id="settingsNicknameInput" type="text" maxlength="60" data-i18n-placeholder="settings_nickname_placeholder" placeholder="Nickname">
                        <label for="languageSelect" data-i18n="settings_language_label">Language</label>
                        <select id="languageSelect">
                            <option value="en" data-i18n="language_name_en">English</option>
                            <option value="fr" data-i18n="language_name_fr">French</option>
                            <option value="de" data-i18n="language_name_de">German</option>
                            <option value="it" data-i18n="language_name_it">Italian</option>
                            <option value="ko" data-i18n="language_name_ko">Korean</option>
                            <option value="ro" data-i18n="language_name_ro">Romanian</option>
                        </select>
                        <label for="settingsThemeSelect" data-i18n="settings_theme_label">Theme</label>
                        <select id="settingsThemeSelect">
                            <option value="standard" data-i18n="settings_theme_standard">Standard</option>
                            <option value="last-war" data-i18n="settings_theme_last_war">Last War</option>
                        </select>
                    </div>

                    <div class="settings-avatar-wrap">
                        <div class="settings-avatar-preview" id="settingsAvatarPreview">
                            <img id="settingsAvatarImage" class="hidden" alt="Avatar preview">
                            <span id="settingsAvatarInitials">U</span>
                        </div>
                        <div class="settings-avatar-actions">
                            <div class="settings-avatar-label" data-i18n="settings_avatar_label">Avatar</div>
                            <div class="settings-avatar-action-row">
                                <button id="settingsAvatarUploadBtn" class="secondary"><span data-i18n="settings_avatar_upload">Upload Avatar</span></button>
                                <button id="settingsAvatarRemoveBtn" class="clear-btn"><span data-i18n="settings_avatar_remove">Remove Avatar</span></button>
                            </div>
                            <input id="settingsAvatarInput" type="file" accept=".jpg,.jpeg,.png,.webp,image/jpeg,image/png,image/webp">
                        </div>
                    </div>

                    <div class="settings-danger-zone">
                        <h3 data-i18n="settings_delete_account_title">Delete Account</h3>
                        <p data-i18n="settings_delete_account_desc">This will permanently remove your user and all data from the platform.</p>
                        <label for="settingsDeleteConfirmInput" data-i18n="settings_delete_account_input_label">Type "delete" to confirm</label>
                        <input id="settingsDeleteConfirmInput" type="text" maxlength="40" data-i18n-placeholder="settings_delete_account_input_placeholder" placeholder="Type delete">
                        <button id="settingsDeleteBtn" class="danger-btn"><span data-i18n="settings_delete_account_button">Delete My Account</span></button>
                    </div>

                    <div id="settingsStatus"></div>
                    <div class="settings-modal-actions">
                        <button id="settingsCancelBtn" class="secondary"><span data-i18n="settings_cancel">Cancel</span></button>
                        <button id="settingsSaveBtn"><span data-i18n="settings_save">Save</span></button>
                    </div>
                </div>
            </div>

            <div id="uploadTargetModal" class="coord-overlay hidden" role="dialog" aria-modal="true" aria-labelledby="uploadTargetTitle" tabindex="-1">
                <div class="upload-target-card modal-shell modal-shell--upload-target">
                    <h2 id="uploadTargetTitle" class="upload-target-title" data-i18n="upload_target_title">Upload Destination</h2>
                    <p class="upload-target-desc" data-i18n="upload_target_desc">Where should this player data be stored?</p>
                    <div class="upload-target-grid">
                        <button id="uploadPersonalBtn" class="upload-target-btn"><span data-i18n="upload_target_personal">My Database</span></button>
                        <button id="uploadAllianceBtn" class="secondary upload-target-btn"><span data-i18n="upload_target_alliance">Alliance Database</span></button>
                        <button id="uploadBothBtn" class="secondary upload-target-btn"><span data-i18n="upload_target_both">Both</span></button>
                    </div>
                    <button id="uploadTargetCloseBtn" class="clear-btn upload-target-close-btn"><span data-i18n="close">Close</span></button>
                </div>
            </div>

            <div id="coordPickerOverlay" class="coord-overlay hidden" role="dialog" aria-modal="true" aria-labelledby="coordPickerTitle" tabindex="-1">
                <div class="coord-picker-card modal-shell modal-shell--coord-picker">
                    <div id="coordHeader">
                        <h2 id="coordPickerTitle" class="modal-title" data-i18n="coord_picker_title">Player Name Label Position Picker</h2>
                        <button id="coordCloseBtn" class="clear-btn"><span data-i18n="close">Close</span></button>
                    </div>
                    <p class="coord-picker-help" data-i18n="coord_picker_help">Click the map to set the center point where player name labels will appear for the selected building. Update buildings one by one.</p>
                    <div id="coordEventName"></div>
                    <div id="coordBuildingRow">
                        <strong id="coordBuildingLabel" data-i18n="coord_label_building">Building</strong>
                        <span id="coordBuildingIndex"></span>
                    </div>
                    <div id="coordPrompt" data-i18n="coord_prompt_default">Click on the map to place player name labels.</div>
                    <div id="coordBuildingValue"></div>
                    <canvas id="coordCanvas"></canvas>
                    <div id="coordActions">
                        <button id="coordPrevBtn" class="secondary"><span data-i18n="coord_prev">Prev</span></button>
                        <button id="coordNextBtn" class="secondary"><span data-i18n="coord_next">Next</span></button>
                        <button id="coordSaveBtn"><span data-i18n="coord_save">Save Coordinates</span></button>
                    </div>
                    <div id="coordStatus"></div>
                </div>
            </div>

            <div id="generatorPage" class="app-view screen-shell">
                <!-- Player Selection Section -->
                <div id="selectionSection" class="card screen-panel hidden">
                    <div class="event-selector event-selector-inline" id="selectionEventSelector"></div>
                    <div class="screen-header">
                        <h2 class="section-title" data-i18n="select_players_for_event_title">Select players for the event</h2>
                    </div>
                    <div id="selectionSourceControls" class="selection-source-controls hidden">
                        <span class="selection-source-title" data-i18n="alliance_player_source_title">Player Source</span>
                        <div class="selection-source-actions">
                            <button id="selectionSourcePersonalBtn" class="secondary" type="button"><span data-i18n="alliance_source_personal">My Database</span></button>
                            <button id="selectionSourceAllianceBtn" class="secondary" type="button"><span data-i18n="alliance_source_alliance">Alliance Database</span></button>
                        </div>
                        <div id="selectionSourceStatus"></div>
                    </div>
                    <p class="section-help" data-i18n="select_teams_help">Select players for Team A and Team B independently. Maximum 20 players per team.</p>
                    
                    <!-- Team Counters -->
                    <div class="team-counters">
                        <div class="counter team-a">
                            <span data-i18n="team_a_label">Team A</span>:
                            <span id="teamAStarterCount">0</span>/20 |
                            <span data-i18n="subs_short">Sub</span>: <span id="teamASubCount">0</span>/10
                        </div>
                        <div class="counter team-b">
                            <span data-i18n="team_b_label">Team B</span>:
                            <span id="teamBStarterCount">0</span>/20 |
                            <span data-i18n="subs_short">Sub</span>: <span id="teamBSubCount">0</span>/10
                        </div>
                    </div>
                    
                    <!-- Filters -->
                    <div class="filters">
                        <input type="text" id="searchFilter" placeholder="ðŸ” Search player name..." data-i18n-placeholder="search_placeholder">
                        <div class="filter-dropdown" id="troopsFilterWrapper">
                            <button class="filter-icon-btn" id="troopsFilterBtn">
                                <svg width="18" height="18" viewBox="0 0 18 18" fill="none"><path d="M2 4h14l-5 6v4l-4 2V10L2 4z" stroke="currentColor" stroke-width="1.5" stroke-linejoin="round"/></svg>
                            </button>
                            <div class="filter-dropdown-panel" id="troopsFilterPanel">
                                <div class="filter-option selected" data-value="" data-i18n="troops_filter_all">All Troop Types</div>
                                <div class="filter-option" data-value="Tank" data-i18n="troops_filter_tank">Tank</div>
                                <div class="filter-option" data-value="Aero" data-i18n="troops_filter_aero">Aero</div>
                                <div class="filter-option" data-value="Missile" data-i18n="troops_filter_missile">Missile</div>
                            </div>
                        </div>
                        <div class="filter-dropdown" id="sortFilterWrapper">
                            <button class="filter-icon-btn" id="sortFilterBtn">
                                <svg width="18" height="18" viewBox="0 0 18 18" fill="none"><path d="M6 11l3 3 3-3M12 7L9 4 6 7" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
                            </button>
                            <div class="filter-dropdown-panel" id="sortFilterPanel">
                                <div class="filter-option selected" data-value="power-desc" data-i18n="sort_power_desc">Sort by Power (High to Low)</div>
                                <div class="filter-option" data-value="power-asc" data-i18n="sort_power_asc">Sort by Power (Low to High)</div>
                                <div class="filter-option" data-value="name-asc" data-i18n="sort_name_asc">Sort by Name (A-Z)</div>
                                <div class="filter-option" data-value="name-desc" data-i18n="sort_name_desc">Sort by Name (Z-A)</div>
                            </div>
                        </div>
                        <button class="filter-icon-btn" id="clearAllBtn" title="Clear All">
                            <svg width="18" height="18" viewBox="0 0 18 18" fill="none"><circle cx="9" cy="9" r="7" stroke="currentColor" stroke-width="1.5"/><path d="M6 6l6 6M12 6l-6 6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/></svg>
                        </button>
                    </div>
                    
                    <!-- Players Table -->
                    <div class="responsive-table-wrap">
                        <table class="players-table responsive-table-card" id="playersTable">
                            <thead>
                                <tr>
                                    <th>
                                        <span class="table-head-content">
                                            <svg class="table-head-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.9" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><circle cx="12" cy="8.2" r="3.3"></circle><path d="M5.5 18.6c0-3.1 2.9-5.5 6.5-5.5s6.5 2.4 6.5 5.5"></path></svg>
                                            <span class="table-head-text" data-i18n="table_header_player_name">Player Name</span>
                                        </span>
                                    </th>
                                    <th>
                                        <span class="table-head-content">
                                            <svg class="table-head-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.9" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M13.8 2.8 6.5 13.1h4.9l-1.2 8.1 7.3-10.3h-4.9z"></path></svg>
                                            <span class="table-head-text" data-i18n="table_header_power">1st Team Power (M)</span>
                                        </span>
                                    </th>
                                    <th>
                                        <span class="table-head-content">
                                            <svg class="table-head-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.9" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M12 3.2 6 5.6v5.2c0 3.8 2.5 7.4 6 9.8 3.5-2.4 6-6 6-9.8V5.6z"></path></svg>
                                            <span class="table-head-text" data-i18n="table_header_thp">THP</span>
                                        </span>
                                    </th>
                                    <th>
                                        <span class="table-head-content">
                                            <svg class="table-head-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.9" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M12 3v18M3 12h18"></path><circle cx="12" cy="12" r="8"></circle></svg>
                                            <span class="table-head-text" data-i18n="table_header_troop">Troop Type</span>
                                        </span>
                                    </th>
                                    <th>
                                        <span class="table-head-content">
                                            <svg class="table-head-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.9" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><circle cx="9" cy="9" r="2.6"></circle><circle cx="16.5" cy="8.5" r="2.1"></circle><path d="M4.2 18.5c0-2.8 2.2-4.9 4.8-4.9"></path><path d="M11.7 18.5c0-2.6 2-4.5 4.6-4.5"></path></svg>
                                            <span class="table-head-text" data-i18n="table_header_team_selection">Team Selection</span>
                                        </span>
                                    </th>
                                </tr>
                            </thead>
                            <tbody id="playersTableBody">
                                <!-- Players will be dynamically inserted here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="playersManagementPage" class="app-view screen-shell hidden">
                <div class="page-header screen-header">
                    <h2 class="config-title" data-i18n="players_management_page_title">Players Management</h2>
                </div>

                <!-- Upload Section (Collapsible when players exist) -->
                <div id="uploadSection" class="card screen-panel">
                    <div id="uploadPanelHeader" class="collapsible-header">
                        <div>
                            <h2 class="inline-title" data-i18n="player_db_title">ðŸ“Š Player Database</h2>
                            <span id="uploadHint"></span>
                            <div id="playerCount"></div>
                        </div>
                        <span class="expand-icon rotated" id="uploadExpandIcon">â–¼</span>
                    </div>
                    
                    <div class="collapsible-content screen-body" id="uploadContent">
                        <p class="section-help" data-i18n="upload_help">Upload your player data. Template headers start at row 10: Player Name, 1st Team Power (M), E1 Troops, THP.</p>

                        <div class="upload-actions-row">
                            <button id="downloadTemplateBtn" class="secondary">ðŸ“¥ <span data-i18n="download_template">Download Template</span></button>
                            <button id="uploadPlayerBtn">ðŸ“¤ <span data-i18n="upload_player_data">Upload Player Data</span></button>
                            <input type="file" id="playerFileInput" accept=".xlsx,.xls">
                        </div>
                        
                        <div id="uploadMessage"></div>
                    </div>
                </div>

                <div id="playersListSection" class="card screen-panel">
                    <div id="playersListPanelHeader" class="collapsible-header">
                        <div>
                            <h2 class="inline-title" data-i18n="players_list_title">Players List</h2>
                            <span id="playersListHint"></span>
                            <div id="playersListCount"></div>
                        </div>
                        <span class="expand-icon rotated" id="playersListExpandIcon">â–¼</span>
                    </div>
                    <div class="collapsible-content screen-body" id="playersListContent">
                        <div id="playersMgmtSourceControls" class="selection-source-controls hidden">
                            <span class="selection-source-title" data-i18n="alliance_player_source_title">Player Source</span>
                            <div class="selection-source-actions">
                                <button id="playersMgmtSourcePersonalBtn" class="secondary" type="button"><span data-i18n="alliance_source_personal">My Database</span></button>
                                <button id="playersMgmtSourceAllianceBtn" class="secondary" type="button"><span data-i18n="alliance_source_alliance">Alliance Database</span></button>
                            </div>
                            <div id="playersMgmtSourceStatus"></div>
                        </div>
                        <div class="players-mgmt-layout">
                            <div class="players-mgmt-surface players-mgmt-add-surface">
                                <button id="playersMgmtAddPanelHeader" class="players-mgmt-inline-header" type="button">
                                    <div class="players-mgmt-inline-title-group">
                                        <h3 class="players-mgmt-inline-title" data-i18n="players_list_add_title">Add New Player</h3>
                                        <p class="players-mgmt-inline-help" data-i18n="players_list_add_help">Create players in the currently selected source.</p>
                                    </div>
                                    <span class="expand-icon" id="playersMgmtAddExpandIcon">&#9662;</span>
                                </button>
                                <div id="playersMgmtAddPanelContent" class="players-mgmt-inline-content collapsed">
                                    <form id="playersMgmtAddForm" class="players-mgmt-add-form">
                                        <input type="text" id="playersMgmtNewName" data-i18n-placeholder="players_list_add_name_placeholder" placeholder="Player Name" maxlength="80">
                                        <input type="number" id="playersMgmtNewPower" data-i18n-placeholder="players_list_add_power_placeholder" placeholder="Power (M)" min="0" step="0.1">
                                        <input type="number" id="playersMgmtNewThp" data-i18n-placeholder="players_list_add_thp_placeholder" placeholder="THP" min="0" step="0.1">
                                        <select id="playersMgmtNewTroops">
                                            <option value="Tank" data-i18n="troops_filter_tank">Tank</option>
                                            <option value="Aero" data-i18n="troops_filter_aero">Aero</option>
                                            <option value="Missile" data-i18n="troops_filter_missile">Missile</option>
                                            <option value="Unknown">Unknown</option>
                                        </select>
                                        <button id="playersMgmtAddBtn" type="submit"><span data-i18n="players_list_add_button">Add Player</span></button>
                                    </form>
                                </div>
                            </div>

                            <div class="players-mgmt-surface players-mgmt-browse-surface">
                                <div class="players-mgmt-inline-headline">
                                    <h3 class="players-mgmt-inline-title" data-i18n="players_list_browse_title">Browse Players</h3>
                                    <div id="playersMgmtFilterSummary" class="players-mgmt-filter-summary"></div>
                                </div>
                                <div class="players-mgmt-filters">
                                    <input type="text" id="playersMgmtSearchFilter" data-i18n-placeholder="search_placeholder" placeholder="Search player name...">
                                    <select id="playersMgmtTroopsFilter">
                                        <option value="" data-i18n="troops_filter_all">All Troop Types</option>
                                        <option value="Tank" data-i18n="troops_filter_tank">Tank</option>
                                        <option value="Aero" data-i18n="troops_filter_aero">Aero</option>
                                        <option value="Missile" data-i18n="troops_filter_missile">Missile</option>
                                        <option value="Unknown">Unknown</option>
                                    </select>
                                    <select id="playersMgmtSortFilter">
                                        <option value="power-desc" data-i18n="sort_power_desc">Sort by Power (High to Low)</option>
                                        <option value="power-asc" data-i18n="sort_power_asc">Sort by Power (Low to High)</option>
                                        <option value="name-asc" data-i18n="sort_name_asc">Sort by Name (A-Z)</option>
                                        <option value="name-desc" data-i18n="sort_name_desc">Sort by Name (Z-A)</option>
                                    </select>
                                    <button id="playersMgmtClearFiltersBtn" class="secondary" type="button" data-i18n="clear_all_selections">Clear All Selections</button>
                                </div>
                                <div class="players-mgmt-table-wrap">
                                    <table class="players-table responsive-table-card" id="playersMgmtTable">
                                        <thead>
                                            <tr>
                                                <th>
                                                    <span class="table-head-content">
                                                        <svg class="table-head-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.9" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><circle cx="12" cy="8.2" r="3.3"></circle><path d="M5.5 18.6c0-3.1 2.9-5.5 6.5-5.5s6.5 2.4 6.5 5.5"></path></svg>
                                                        <span class="table-head-text" data-i18n="table_header_player_name">Player Name</span>
                                                    </span>
                                                </th>
                                                <th>
                                                    <span class="table-head-content">
                                                        <svg class="table-head-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.9" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M13.8 2.8 6.5 13.1h4.9l-1.2 8.1 7.3-10.3h-4.9z"></path></svg>
                                                        <span class="table-head-text" data-i18n="table_header_power">1st Team Power (M)</span>
                                                    </span>
                                                </th>
                                                <th>
                                                    <span class="table-head-content">
                                                        <svg class="table-head-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.9" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M12 3.2 6 5.6v5.2c0 3.8 2.5 7.4 6 9.8 3.5-2.4 6-6 6-9.8V5.6z"></path></svg>
                                                        <span class="table-head-text" data-i18n="table_header_thp">THP</span>
                                                    </span>
                                                </th>
                                                <th>
                                                    <span class="table-head-content">
                                                        <svg class="table-head-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.9" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M12 3v18M3 12h18"></path><circle cx="12" cy="12" r="8"></circle></svg>
                                                        <span class="table-head-text" data-i18n="table_header_troop">Troop Type</span>
                                                    </span>
                                                </th>
                                                <th>
                                                    <span class="table-head-content">
                                                        <svg class="table-head-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.9" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><circle cx="12" cy="12" r="2.6"></circle><path d="M19.4 15a1 1 0 0 0 .2 1.1l.1.1a2 2 0 0 1-2.8 2.8l-.1-.1a1 1 0 0 0-1.1-.2 1 1 0 0 0-.6.9V20a2 2 0 0 1-4 0v-.1a1 1 0 0 0-.6-.9 1 1 0 0 0-1.1.2l-.1.1a2 2 0 1 1-2.8-2.8l.1-.1a1 1 0 0 0 .2-1.1 1 1 0 0 0-.9-.6H4a2 2 0 0 1 0-4h.1a1 1 0 0 0 .9-.6 1 1 0 0 0-.2-1.1l-.1-.1a2 2 0 1 1 2.8-2.8l.1.1a1 1 0 0 0 1.1.2h.1a1 1 0 0 0 .6-.9V4a2 2 0 0 1 4 0v.1a1 1 0 0 0 .6.9h.1a1 1 0 0 0 1.1-.2l.1-.1a2 2 0 1 1 2.8 2.8l-.1.1a1 1 0 0 0-.2 1.1v.1a1 1 0 0 0 .9.6H20a2 2 0 0 1 0 4h-.1a1 1 0 0 0-.9.6z"></path></svg>
                                                        <span class="table-head-text" data-i18n="players_list_actions_header">Actions</span>
                                                    </span>
                                                </th>
                                            </tr>
                                        </thead>
                                        <tbody id="playersMgmtTableBody"></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <div id="playersMgmtStatus"></div>
                    </div>
                </div>
            </div>

            <div id="configurationPage" class="app-view screen-shell hidden">
                <div class="page-header screen-header">
                    <h2 class="config-title" data-i18n="events_manager_title">Events Manager</h2>
                </div>

                <div id="eventsPanel" class="card screen-panel">
                    <div id="eventsPanelHeader" class="collapsible-header screen-header">
                        <div>
                            <h2 class="section-title" data-i18n="events_manager_title">Events Manager</h2>
                            <p class="events-panel-help" data-i18n="events_manager_help">Create custom events with name, logo, map, and building setup.</p>
                        </div>
                        <span class="expand-icon rotated" id="eventsExpandIcon">â–¼</span>
                    </div>
                    <div class="collapsible-content screen-body" id="eventsContent">
                    <div class="events-manager-grid events-manager-grid-spaced">
                        <div class="events-list-card">
                            <h3 class="events-list-title-head" data-i18n="events_manager_existing_title">Existing Events</h3>
                            <div id="eventsList" class="events-list"></div>
                        </div>
                        <div class="events-editor-card">
                            <div class="events-editor-header">
                                <h3 class="events-editor-title" id="eventEditorTitle" data-i18n="events_manager_create_title">Create Event</h3>
                                <button id="eventEditModeBtn" class="secondary event-edit-btn hidden" type="button" title="Edit event" aria-label="Edit event">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 20h9"/><path d="M16.5 3.5a2.1 2.1 0 0 1 3 3L7 19l-4 1 1-4Z"/></svg>
                                </button>
                            </div>
                            <div class="settings-form-grid">
                                <label for="eventNameInput" data-i18n="events_manager_name_label">Event Name</label>
                                <input id="eventNameInput" type="text" maxlength="30" data-i18n-placeholder="events_manager_name_placeholder" placeholder="Event name">
                            </div>
                            <div class="event-media-grid">
                                <div class="event-media-block">
                                    <div class="event-media-label" data-i18n="events_manager_logo_label">Event Avatar</div>
                                    <div class="event-logo-preview">
                                        <img id="eventLogoPreviewImage" alt="Event avatar preview">
                                    </div>
                                    <div id="eventLogoActions" class="event-media-actions">
                                        <button id="eventLogoUploadBtn" class="secondary icon-action-btn" type="button">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.1" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
                                            <span class="sr-only" data-i18n="events_manager_logo_upload">Upload Avatar</span>
                                        </button>
                                        <button id="eventLogoRandomBtn" class="clear-btn icon-action-btn" type="button">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.1" stroke-linecap="round" stroke-linejoin="round"><polyline points="16 3 21 3 21 8"/><line x1="4" y1="20" x2="21" y2="3"/><polyline points="21 16 21 21 16 21"/><line x1="15" y1="15" x2="21" y2="21"/><line x1="4" y1="4" x2="9" y2="9"/></svg>
                                            <span class="sr-only" data-i18n="events_manager_logo_randomize">Random Avatar</span>
                                        </button>
                                    </div>
                                    <input id="eventLogoInput" type="file" accept=".jpg,.jpeg,.png,.webp,image/jpeg,image/png,image/webp">
                                </div>
                                <div class="event-media-block">
                                    <div class="event-media-label" data-i18n="events_manager_map_label">Event Map</div>
                                    <div class="event-map-preview">
                                        <img id="eventMapPreviewImage" class="hidden" alt="Event map preview">
                                        <div id="eventMapPreviewPlaceholder" class="event-map-placeholder" data-i18n="events_manager_map_placeholder">No map uploaded</div>
                                    </div>
                                    <div id="eventMapActions" class="event-media-actions">
                                        <button id="eventMapUploadBtn" class="secondary icon-action-btn" type="button">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.1" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
                                            <span class="sr-only" data-i18n="events_manager_map_upload">Upload Map</span>
                                        </button>
                                        <button id="eventMapRemoveBtn" class="clear-btn icon-action-btn" type="button">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.1" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6l-1 14a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2L5 6"/><path d="M10 11v6"/><path d="M14 11v6"/><path d="M9 6V4a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v2"/></svg>
                                            <span class="sr-only" data-i18n="events_manager_map_remove">Remove Map</span>
                                        </button>
                                    </div>
                                    <input id="eventMapInput" type="file" accept=".jpg,.jpeg,.png,.webp,image/jpeg,image/png,image/webp">
                                </div>
                            </div>
                            <div class="event-buildings-block">
                                <h4 class="event-buildings-title" data-i18n="events_manager_buildings_title">Buildings</h4>
                                <p class="event-buildings-help" data-i18n="events_manager_buildings_help">Define building name, #Players, and priority for this event.</p>
                                <div class="responsive-table-wrap">
                                    <table class="players-table responsive-table-card" id="eventBuildingsEditorTable">
                                        <thead>
                                            <tr>
                                                <th data-i18n="buildings_table_building">Building</th>
                                                <th data-i18n="buildings_table_slots">#Players</th>
                                                <th data-i18n="buildings_table_priority">Priority</th>
                                                <th data-i18n="buildings_table_display">Type</th>
                                                <th data-i18n="events_manager_actions">Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="eventBuildingsEditorBody"></tbody>
                                    </table>
                                </div>
                                <div class="screen-actions event-buildings-actions">
                                    <button id="eventAddBuildingBtn" class="secondary event-add-building-btn" type="button">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.1" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                                            <path d="M3 21h18"/>
                                            <path d="M5 21V9l7-5 7 5v12"/>
                                            <path d="M9 21v-6h6v6"/>
                                        </svg>
                                        <span class="event-add-building-plus" aria-hidden="true">+</span>
                                        <span class="sr-only" data-i18n="events_manager_add_building">Add Building</span>
                                    </button>
                                </div>
                            </div>
                            <div class="event-editor-actions">
                                <button id="eventSaveBtn" type="button"><span data-i18n="events_manager_save_event">Save Event</span></button>
                                <button id="eventCancelEditBtn" class="secondary hidden" type="button"><span data-i18n="settings_cancel">Cancel</span></button>
                                <button id="eventDeleteBtn" class="secondary" type="button"><span data-i18n="events_manager_delete_event">Delete Event</span></button>
                            </div>
                            <div id="eventsStatus"></div>
                        </div>
                    </div>
                    </div>
                </div>
                <div class="card screen-panel">
                    <div class="screen-header">
                        <h2 class="section-title" data-i18n="map_coordinates_tool_title">Player Name Label Coordinates</h2>
                        <button id="mapCoordinatesBtn" class="secondary"><span data-i18n="map_coordinates">Map Coordinates</span></button>
                    </div>
                    <p class="section-help section-help-tight" data-i18n="map_coordinates_tool_help">Use this after Buildings setup. The picker uses the currently selected event and its building names, then lets you place one coordinate per building on the event map. Each click sets the center point for the first player label for that building; the rest align from that anchor. Save when finished to apply these positions to generated and exported maps.</p>
                </div>
            </div>
            
            <!-- Team A & B Sections removed - replaced with floating buttons -->
            
            
            <!-- Download Modal -->
            <div id="downloadModalOverlay" class="coord-overlay hidden" role="dialog" aria-modal="true" aria-labelledby="downloadModalTitle" tabindex="-1">
                <div class="download-modal-card modal-shell modal-shell--download">
                    <div class="download-modal-header">
                        <h2 id="downloadModalTitle" class="modal-title"></h2>
                        <button id="downloadModalCloseBtn" class="clear-btn"><span data-i18n="close">Close</span></button>
                    </div>
                    <p id="downloadModalSubtitle"></p>
                    <div id="downloadBtnGrid">
                        <button id="downloadMapBtn">
                            ðŸ—ºï¸ <span data-i18n="download_map">Map</span>
                        </button>
                        <button id="downloadExcelBtn">
                            ðŸ“Š <span data-i18n="download_excel">Excel</span>
                        </button>
                    </div>
                    <div id="downloadStatus"></div>
                </div>
            </div>
        </div>

        <nav id="mobileBottomNav" class="mobile-bottom-nav" aria-label="Primary Mobile Navigation">
            <button id="mobileNavGeneratorBtn" class="mobile-bottom-nav-btn" type="button">
                <svg class="mobile-bottom-nav-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.9" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                    <path d="M5 12h14"></path>
                    <path d="M12 5v14"></path>
                    <circle cx="12" cy="12" r="8"></circle>
                </svg>
                <span class="mobile-bottom-nav-label" data-i18n="generator_button">Generator</span>
            </button>
            <button id="mobileNavPlayersBtn" class="mobile-bottom-nav-btn" type="button">
                <svg class="mobile-bottom-nav-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.9" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                    <circle cx="9" cy="8.5" r="3"></circle>
                    <path d="M3.5 18.5c0-2.9 2.4-5.2 5.5-5.2s5.5 2.3 5.5 5.2"></path>
                    <circle cx="17.5" cy="9.5" r="2.2"></circle>
                    <path d="M14.8 18.5c.2-2.1 1.8-3.8 3.9-4.1"></path>
                </svg>
                <span class="mobile-bottom-nav-label" data-i18n="players_management_button">Players Management</span>
            </button>
            <button id="mobileNavConfigBtn" class="mobile-bottom-nav-btn" type="button">
                <svg class="mobile-bottom-nav-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.9" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                    <rect x="4" y="5" width="16" height="15" rx="2.2"></rect>
                    <path d="M8 3.8v2.4M16 3.8v2.4M4 10h16"></path>
                    <path d="M8 14h3M13 14h3"></path>
                </svg>
                <span class="mobile-bottom-nav-label" data-i18n="events_manager_title">Events Manager</span>
            </button>
            <button id="mobileNavAllianceBtn" class="mobile-bottom-nav-btn" type="button">
                <svg class="mobile-bottom-nav-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.9" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                    <path d="M7.2 7.8a2.8 2.8 0 1 1 5.6 0c0 1.5-1.3 2.8-2.8 2.8S7.2 9.3 7.2 7.8Z"></path>
                    <path d="M11 14.2h2"></path>
                    <path d="M4.2 18.5c0-2.8 2.3-5 5.2-5"></path>
                    <path d="M19.8 18.5c0-2.8-2.3-5-5.2-5"></path>
                    <path d="M14.8 7.1h4.4M17 4.9v4.4"></path>
                </svg>
                <span class="mobile-bottom-nav-label" data-i18n="alliance_button">Alliance</span>
            </button>
        </nav>

        <!-- Floating Generate Buttons -->
        <div class="floating-buttons" id="floatingButtons">
            <button class="generate-btn" id="generateBtnA" disabled>
                <span class="generate-event-label" id="generateEventLabelA">DESERT STORM</span>
                <span class="generate-team-summary"><span data-i18n="team_a_label">Team A</span> (<span id="teamAFloatStarterCount">0</span>/20 | <span data-i18n="subs_short">Sub</span>: <span id="teamAFloatSubCount">0</span>/10)</span>
                ðŸš€ <span data-i18n="generate_team_a">Generate Team A</span>
            </button>
            <button class="generate-btn" id="generateBtnB" disabled>
                <span class="generate-event-label" id="generateEventLabelB">DESERT STORM</span>
                <span class="generate-team-summary"><span data-i18n="team_b_label">Team B</span> (<span id="teamBFloatStarterCount">0</span>/20 | <span data-i18n="subs_short">Sub</span>: <span id="teamBFloatSubCount">0</span>/10)</span>
                ðŸš€ <span data-i18n="generate_team_b">Generate Team B</span>
            </button>
        </div>

        <!-- Onboarding Tour Tooltip (reused for each step) -->
        <div id="onboardingTooltip" class="onboarding-tooltip hidden">
            <div class="onboarding-step-label" id="onboardingStepLabel"></div>
            <div class="onboarding-title"      id="onboardingTitle"></div>
            <div class="onboarding-desc"       id="onboardingDesc"></div>
            <div class="onboarding-skip"       id="onboardingSkip"></div>
        </div>
    </main>

    <script defer src="translations.js"></script>
    <script defer src="js/core/events.js"></script>
    <script defer src="js/core/assignment.js"></script>
    <script defer src="js/core/buildings.js"></script>
    <script defer src="js/core/player-table.js"></script>
    <script defer src="js/ui/player-table-ui.js"></script>
    <script defer src="js/ui/alliance-panel-ui.js"></script>
    <script defer src="js/ui/event-list-ui.js"></script>
    <script defer src="js/ui/event-buildings-editor-ui.js"></script>
    <script defer src="js/core/i18n.js"></script>
    <script defer src="js/services/firebase-service.js"></script>
    <script defer src="app.js"></script>
    <script defer src="js/app-init.js"></script>
</body>
</html>
