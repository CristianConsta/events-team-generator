<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Desert Storm - Team Generator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@700;900&family=Rajdhani:wght@400;600;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --primary: #FF6B35;
            --secondary: #F7931E;
            --accent: #FDC830;
            --dark: #1A1A2E;
            --darker: #16213E;
            --light: #FFFFFF;
        }
        
        body {
            font-family: 'Rajdhani', sans-serif;
            background: var(--dark);
            color: var(--light);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }
        
        /* Animated background - desert theme */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 30% 40%, rgba(255, 107, 53, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 70% 70%, rgba(247, 147, 30, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 50% 90%, rgba(253, 200, 48, 0.15) 0%, transparent 50%);
            animation: pulse 10s ease-in-out infinite;
            z-index: 0;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }
        
        .container {
            position: relative;
            z-index: 1;
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
        }
        
        header {
            text-align: center;
            margin-bottom: 60px;
            animation: slideDown 0.8s ease-out;
        }
        
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        h1 {
            font-family: 'Orbitron', sans-serif;
            font-size: 3.5rem;
            font-weight: 900;
            background: linear-gradient(135deg, var(--primary), var(--secondary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }
        
        .subtitle {
            font-size: 1.3rem;
            color: var(--accent);
            font-weight: 600;
            letter-spacing: 4px;
        }
        
        .upload-section {
            background: var(--darker);
            border-radius: 20px;
            padding: 50px;
            margin-bottom: 40px;
            border: 2px solid rgba(253, 200, 48, 0.3);
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
            animation: fadeIn 1s ease-out 0.3s both;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .upload-area {
            border: 3px dashed var(--accent);
            border-radius: 15px;
            padding: 60px 40px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            background: rgba(253, 200, 48, 0.05);
        }
        
        .upload-area:hover {
            background: rgba(253, 200, 48, 0.1);
            border-color: var(--light);
            transform: scale(1.02);
        }
        
        .upload-area.dragover {
            background: rgba(253, 200, 48, 0.2);
            border-color: var(--light);
            transform: scale(1.05);
        }
        
        .upload-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            animation: float 3s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        .upload-text {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 10px;
            color: var(--accent);
        }
        
        .upload-subtext {
            font-size: 1.1rem;
            color: rgba(255, 255, 255, 0.6);
        }
        
        input[type="file"] {
            display: none;
        }
        
        .processing {
            display: none;
            text-align: center;
            padding: 40px;
            animation: fadeIn 0.5s ease-out;
        }
        
        .spinner {
            width: 60px;
            height: 60px;
            border: 5px solid rgba(253, 200, 48, 0.2);
            border-top-color: var(--accent);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .processing-text {
            font-size: 1.3rem;
            color: var(--accent);
            font-weight: 600;
        }
        
        .results {
            display: none;
            animation: fadeIn 0.8s ease-out;
        }
        
        .result-card {
            background: var(--darker);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 20px;
            border: 2px solid rgba(255, 107, 53, 0.3);
            transition: all 0.3s ease;
        }
        
        .result-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.5);
            border-color: var(--primary);
        }
        
        .result-title {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--accent);
            margin-bottom: 15px;
        }
        
        .download-btn {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: var(--light);
            border: none;
            padding: 15px 40px;
            border-radius: 10px;
            font-size: 1.2rem;
            font-weight: 700;
            font-family: 'Rajdhani', sans-serif;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 20px rgba(255, 107, 53, 0.4);
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .download-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(255, 107, 53, 0.6);
        }
        
        .info-section {
            background: rgba(22, 33, 62, 0.6);
            border-radius: 15px;
            padding: 30px;
            margin-top: 40px;
            border-left: 5px solid var(--accent);
        }
        
        .info-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--accent);
            margin-bottom: 15px;
        }
        
        .info-list {
            list-style: none;
            padding: 0;
        }
        
        .info-list li {
            padding: 10px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 1.1rem;
        }
        
        .info-list li:before {
            content: "üèúÔ∏è";
            margin-right: 10px;
        }
        
        .error {
            background: rgba(255, 107, 53, 0.2);
            border: 2px solid var(--primary);
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            display: none;
        }
        
        .error-text {
            color: var(--light);
            font-size: 1.1rem;
        }
        
        @media (max-width: 768px) {
            h1 {
                font-size: 2rem;
            }
            
            .subtitle {
                font-size: 1rem;
            }
            
            .upload-section {
                padding: 30px 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üèúÔ∏è Desert Storm üèúÔ∏è</h1>
            <p class="subtitle">Team Assignment Generator</p>
        </header>
        
        <div class="upload-section">
            <div class="upload-area" id="uploadArea">
                <div class="upload-icon">üì§</div>
                <div class="upload-text">Upload Your Player Excel File</div>
                <div class="upload-subtext">Click or drag & drop your player file here</div>
                <input type="file" id="fileInput" accept=".xlsx,.xls">
            </div>
            <div class="error" id="error">
                <p class="error-text" id="errorText"></p>
            </div>
        </div>
        
        <div class="processing" id="processing">
            <div class="spinner"></div>
            <p class="processing-text">Processing assignments and generating infographics...</p>
        </div>
        
        <div class="results" id="results">
            <div class="result-card">
                <div class="result-title">üìä Team Assignments Excel</div>
                <p style="margin-bottom: 20px; opacity: 0.8;">Complete player assignments for both Team A and Team B</p>
                <button class="download-btn" id="downloadExcel">‚¨áÔ∏è Download Excel File</button>
            </div>
            
            <div class="result-card">
                <div class="result-title">üì± Team A Table Infographic</div>
                <p style="margin-bottom: 20px; opacity: 0.8;">Professional table-style assignment sheet for Team A</p>
                <button class="download-btn" id="downloadTeamA">‚¨áÔ∏è Download Team A Image</button>
            </div>
            
            <div class="result-card">
                <div class="result-title">üì± Team B Table Infographic</div>
                <p style="margin-bottom: 20px; opacity: 0.8;">Professional table-style assignment sheet for Team B</p>
                <button class="download-btn" id="downloadTeamB">‚¨áÔ∏è Download Team B Image</button>
            </div>
        </div>
        
        <div class="info-section">
            <div class="info-title">üì• Need the Excel Template?</div>
            <p style="margin-bottom: 20px; opacity: 0.9; font-size: 1.1rem;">
                Download the template and mark players for Desert Storm in columns J (Team A) and L (Team B)
            </p>
            <button class="download-btn" id="downloadTemplate" style="background: linear-gradient(135deg, var(--accent), var(--secondary));">
                ‚¨áÔ∏è Download Excel Template
            </button>
        </div>
        
        <div class="info-section" style="margin-top: 30px;">
            <div class="info-title">‚ÑπÔ∏è How It Works</div>
            <ul class="info-list">
                <li>Download template or use your existing file</li>
                <li>Mark "Y" in column J (Team A) or column L (Team B)</li>
                <li>Upload completed file</li>
                <li>Get strategic assignments + table infographics</li>
                <li>Share with your teams!</li>
            </ul>
        </div>
    </div>

    <script>
        let workbook = null;
        let teamAAssignments = [];
        let teamBAssignments = [];
        
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        const processing = document.getElementById('processing');
        const results = document.getElementById('results');
        const errorDiv = document.getElementById('error');
        const errorText = document.getElementById('errorText');
        
        uploadArea.addEventListener('click', () => fileInput.click());
        
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });
        
        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });
        
        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            const file = e.dataTransfer.files[0];
            if (file) handleFile(file);
        });
        
        fileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) handleFile(file);
        });
        
        function showError(message) {
            errorText.textContent = message;
            errorDiv.style.display = 'block';
            setTimeout(() => {
                errorDiv.style.display = 'none';
            }, 5000);
        }
        
        function handleFile(file) {
            if (!file.name.endsWith('.xlsx') && !file.name.endsWith('.xls')) {
                showError('Please upload an Excel file (.xlsx or .xls)');
                return;
            }
            
            processing.style.display = 'block';
            errorDiv.style.display = 'none';
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    workbook = XLSX.read(e.target.result, { type: 'binary' });
                    processWorkbook();
                } catch (error) {
                    showError('Error reading Excel file: ' + error.message);
                    processing.style.display = 'none';
                }
            };
            reader.readAsBinaryString(file);
        }
        
        function processWorkbook() {
            try {
                const playersSheet = workbook.Sheets['Players'];
                const teamASheet = workbook.Sheets['Desert Storm- Team A'];
                const teamBSheet = workbook.Sheets['Desert Storm- Team B'];
                
                if (!playersSheet || !teamASheet) {
                    showError('Excel file must contain "Players" and "Desert Storm- Team A" sheets');
                    processing.style.display = 'none';
                    return;
                }
                
                const players = XLSX.utils.sheet_to_json(playersSheet);
                const teamABuildings = XLSX.utils.sheet_to_json(teamASheet);
                const teamBBuildings = teamBSheet ? XLSX.utils.sheet_to_json(teamBSheet) : [];
                
                // Process Team A (column J)
                teamAAssignments = assignPlayers(players, teamABuildings, 'Desert  Storm - Team A');
                
                // Process Team B (column L)
                if (teamBBuildings.length > 0) {
                    teamBAssignments = assignPlayers(players, teamBBuildings, 'Desert  Storm -Team B');
                }
                
                setTimeout(() => {
                    processing.style.display = 'none';
                    results.style.display = 'block';
                }, 1500);
                
            } catch (error) {
                showError('Error processing file: ' + error.message);
                processing.style.display = 'none';
            }
        }
        
        function assignPlayers(players, buildings, teamColumn) {
            const eligible = players
                .filter(p => p[teamColumn] === 'Y')
                .map(p => ({
                    name: p['Player Name'],
                    power: p['E1 total power(M)'] || 0,
                    troops: p['E1 troops'] || 'Unknown'
                }))
                .sort((a, b) => b.power - a.power);
            
            const assignments = [];
            const available = [...eligible];
            
            // Sort buildings by priority
            const sorted = buildings.sort((a, b) => a['Priority'] - b['Priority']);
            
            sorted.forEach(building => {
                let player = null;
                if (available.length > 0) {
                    player = available.shift();
                }
                
                assignments.push({
                    building: building['Buildig Name'],
                    priority: building['Priority'],
                    player: player ? player.name : '',
                    power: player ? player.power : 0,
                    troops: player ? player.troops : ''
                });
            });
            
            return assignments;
        }
        
        // Download Excel
        document.getElementById('downloadExcel').addEventListener('click', () => {
            const wb = XLSX.utils.book_new();
            
            const teamAData = teamAAssignments.map(a => ({
                'Buildig Name': a.building,
                'Priority': a.priority,
                'Player name': a.player
            }));
            const wsA = XLSX.utils.json_to_sheet(teamAData);
            XLSX.utils.book_append_sheet(wb, wsA, 'Desert Storm- Team A');
            
            if (teamBAssignments.length > 0) {
                const teamBData = teamBAssignments.map(a => ({
                    'Buildig Name': a.building,
                    'Priority': a.priority,
                    'Player name': a.player
                }));
                const wsB = XLSX.utils.json_to_sheet(teamBData);
                XLSX.utils.book_append_sheet(wb, wsB, 'Desert Storm- Team B');
            }
            
            XLSX.writeFile(wb, 'desert_storm_assignments.xlsx');
        });
        
        // Download Team A Image
        document.getElementById('downloadTeamA').addEventListener('click', () => {
            generateInfographic(teamAAssignments, 'TEAM A');
        });
        
        // Download Team B Image
        document.getElementById('downloadTeamB').addEventListener('click', () => {
            if (teamBAssignments.length > 0) {
                generateInfographic(teamBAssignments, 'TEAM B');
            } else {
                showError('No Team B data available');
            }
        });
        
        function generateInfographic(assignments, teamName) {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            
            const width = 900;  // Narrower - only 3 columns
            const rowHeight = 45;
            const headerHeight = 60;
            const titleHeight = 80;
            const numRows = assignments.length;
            
            const height = titleHeight + headerHeight + (numRows * rowHeight) + 50;
            
            canvas.width = width;
            canvas.height = height;
            
            // Priority colors - Desert Storm theme
            const priorityColors = {
                1: '#FFB6C1', 2: '#FFB6C1',
                3: '#90EE90', 4: '#ADD8E6',
                5: '#ADD8E6', 6: '#90EE90'
            };
            
            // White background
            ctx.fillStyle = '#FFFFFF';
            ctx.fillRect(0, 0, width, height);
            
            // Title - Desert theme
            const gradient = ctx.createLinearGradient(0, 0, width, titleHeight);
            gradient.addColorStop(0, '#FF6B35');
            gradient.addColorStop(0.5, '#F7931E');
            gradient.addColorStop(1, '#FDC830');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, width, titleHeight);
            
            ctx.font = 'bold 36px Arial';
            ctx.fillStyle = '#FFFFFF';
            ctx.textAlign = 'center';
            ctx.fillText(`${teamName} - DESERT STORM`, width/2, titleHeight/2 + 12);
            
            let yPos = titleHeight;
            
            // Columns - matching Excel exactly
            const columns = [
                {name: 'Buildig Name', width: 400, align: 'left'},
                {name: 'Priority', width: 150, align: 'center'},
                {name: 'Player name', width: 350, align: 'left'}
            ];
            
            // Header
            ctx.fillStyle = '#34495E';
            ctx.fillRect(0, yPos, width, headerHeight);
            
            let xPos = 0;
            ctx.font = 'bold 14px Arial';
            ctx.fillStyle = '#FFFFFF';
            ctx.lineWidth = 2;
            ctx.strokeStyle = '#000000';
            
            columns.forEach(col => {
                ctx.beginPath();
                ctx.moveTo(xPos, yPos);
                ctx.lineTo(xPos, yPos + headerHeight);
                ctx.stroke();
                
                ctx.textAlign = col.align;
                const textX = col.align === 'center' ? xPos + col.width/2 : xPos + 10;
                ctx.fillText(col.name, textX, yPos + headerHeight/2 + 5);
                
                xPos += col.width;
            });
            
            ctx.beginPath();
            ctx.moveTo(width, yPos);
            ctx.lineTo(width, yPos + headerHeight);
            ctx.stroke();
            
            ctx.beginPath();
            ctx.moveTo(0, yPos + headerHeight);
            ctx.lineTo(width, yPos + headerHeight);
            ctx.stroke();
            
            yPos += headerHeight;
            
            // Data rows
            ctx.font = '12px Arial';
            ctx.lineWidth = 1;
            ctx.fillStyle = '#000000';
            
            assignments.forEach(row => {
                const bgColor = priorityColors[row.priority] || '#FFFFFF';
                ctx.fillStyle = bgColor;
                ctx.fillRect(0, yPos, width, rowHeight);
                
                ctx.fillStyle = '#000000';
                
                const rowData = [
                    {text: row.building || '', width: columns[0].width, align: columns[0].align},
                    {text: row.priority ? String(row.priority) : '', width: columns[1].width, align: columns[1].align},
                    {text: row.player || '', width: columns[2].width, align: columns[2].align}
                ];
                
                xPos = 0;
                rowData.forEach(cell => {
                    ctx.beginPath();
                    ctx.moveTo(xPos, yPos);
                    ctx.lineTo(xPos, yPos + rowHeight);
                    ctx.stroke();
                    
                    ctx.textAlign = cell.align;
                    const textX = cell.align === 'center' ? xPos + cell.width/2 : xPos + 10;
                    ctx.fillText(cell.text, textX, yPos + rowHeight/2 + 4);
                    
                    xPos += cell.width;
                });
                
                ctx.beginPath();
                ctx.moveTo(width, yPos);
                ctx.lineTo(width, yPos + rowHeight);
                ctx.stroke();
                
                ctx.beginPath();
                ctx.moveTo(0, yPos + rowHeight);
                ctx.lineTo(width, yPos + rowHeight);
                ctx.stroke();
                
                yPos += rowHeight;
            });
            
            canvas.toBlob(blob => {
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `${teamName.toLowerCase().replace(' ', '_')}_desert_storm.png`;
                a.click();
                URL.revokeObjectURL(url);
            });
        }
        
        // Download Template
        document.getElementById('downloadTemplate').addEventListener('click', () => {
            const wb = XLSX.utils.book_new();
            
            // Players sheet template
            const playersData = [
                ['INSTRUCTIONS FOR DESERT STORM:'],
                ['Mark "Y" in column J (Desert  Storm - Team A) for Team A eligibility'],
                ['Mark "Y" in column L (Desert  Storm -Team B) for Team B eligibility'],
                ['Fill in E1 troops (Tank/Aero/Missile) and E1 total power'],
                [''],
                ['', 'Player Name', 'Total Hero Power(M)', 'E1 troops', 'E1 total power(M)', 'Canon Battlefield - Team A', 'Canon Battlefield - Team A(SUB)', 'Canon Battlefield - Team B', 'Canon Battlefield - Team B(SUB)', 'Desert  Storm - Team A', 'Desert  Storm - Team A(SUB)', 'Desert  Storm -Team B', 'Desert  Storm -Team B(SUB)'],
                [1, 'Example Player', '', 'Tank', 65.0, '', '', '', '', 'Y', '', '', ''],
            ];
            const wsPlayers = XLSX.utils.aoa_to_sheet(playersData);
            wsPlayers['!cols'] = [
                {wch: 8}, {wch: 20}, {wch: 18}, {wch: 12}, {wch: 18},
                {wch: 25}, {wch: 28}, {wch: 25}, {wch: 28}, {wch: 23},
                {wch: 26}, {wch: 20}, {wch: 23}
            ];
            XLSX.utils.book_append_sheet(wb, wsPlayers, 'Players');
            
            // Team A sheet - exact structure
            const teamAData = [
                ['Buildig Name', 'Priority', 'Player name'],
                ['Info center', 5, ''],
                ['Info center', 6, ''],
                ['Oil Rafinery 1', 3, ''],
                ['Oil Rafinery 1', 4, ''],
                ['Oil Rafinery 2', 3, ''],
                ['Oil Rafinery 2', 4, ''],
                ['Hopsital 1', 4, ''],
                ['Hopsital 1', 5, ''],
                ['Hopsital 2', 4, ''],
                ['Hopsital 2', 5, ''],
                ['Hopsital 3', 4, ''],
                ['Hopsital 3', 5, ''],
                ['Hopsital 4', 4, ''],
                ['Hopsital 4', 5, ''],
                ['Science Hub', 2, ''],
                ['Science Hub', 2, ''],
                ['Bomb Squad', 1, ''],
                ['Bomb Squad', 1, ''],
                ['Bomb Squad', 1, ''],
                ['Bomb Squad', 1, ''],
            ];
            const wsTeamA = XLSX.utils.aoa_to_sheet(teamAData);
            wsTeamA['!cols'] = [{wch: 20}, {wch: 10}, {wch: 25}];
            XLSX.utils.book_append_sheet(wb, wsTeamA, 'Desert Storm- Team A');
            
            // Team B sheet - exact structure
            const teamBData = [
                ['Buildig Name', 'Priority', 'Player name'],
                ['Info center', 5, ''],
                ['Info center', 6, ''],
                ['Oil Rafinery 1', 3, ''],
                ['Oil Rafinery 1', 4, ''],
                ['Oil Rafinery 2', 3, ''],
                ['Oil Rafinery 2', 4, ''],
                ['Hopsital 1', 4, ''],
                ['Hopsital 1', 5, ''],
                ['Hopsital 2', 4, ''],
                ['Hopsital 2', 5, ''],
                ['Hopsital 3', 4, ''],
                ['Hopsital 3', 5, ''],
                ['Hopsital 4', 4, ''],
                ['Hopsital 4', 5, ''],
                ['Science Hub', 2, ''],
                ['Science Hub', 2, ''],
                ['Bomb Squad', 1, ''],
                ['Bomb Squad', 1, ''],
                ['Bomb Squad', 1, ''],
                ['Bomb Squad', 1, ''],
            ];
            const wsTeamB = XLSX.utils.aoa_to_sheet(teamBData);
            wsTeamB['!cols'] = [{wch: 20}, {wch: 10}, {wch: 25}];
            XLSX.utils.book_append_sheet(wb, wsTeamB, 'Desert Storm- Team B');
            
            XLSX.writeFile(wb, 'desert_storm_template.xlsx');
        });
    </script>
</body>
</html>
